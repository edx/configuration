{% include "edxapp_common.j2" %}

{% if edxapp_staticfiles_storage_overrides %}
{% for override in edxapp_staticfiles_storage_overrides %}
sudo -E -H -u {{ edxapp_user }} \
    env "PATH=$PATH" \
        "STATICFILES_STORAGE={{ override }}" \
        "STATIC_ROOT=/edx/var/edxapp/staticfiles" \
        "STATIC_ROOT_LMS=/edx/var/edxapp/staticfiles" \
        "STATIC_ROOT_CMS=/edx/var/edxapp/staticfiles/studio" \
    npm install \
    && npm run webpack \
    && npm run compile-sass \
    && {{ edxapp_venv_bin }}/python manage.py lms collectstatic --noinput --settings=$EDX_PLATFORM_SETTINGS \
    && {{ edxapp_venv_bin }}/python manage.py cms collectstatic --noinput --settings=$EDX_PLATFORM_SETTINGS
{% endfor %}
{% else %}
sudo -E -H -u {{ edxapp_user }} \
    env "PATH=$PATH" \
        "STATICFILES_STORAGE=django.contrib.staticfiles.storage.StaticFilesStorage" \
        "STATIC_ROOT=/edx/var/edxapp/staticfiles" \
        "STATIC_ROOT_LMS=/edx/var/edxapp/staticfiles" \
        "STATIC_ROOT_CMS=/edx/var/edxapp/staticfiles/studio" \
    npm install \
    && npm run webpack \
    && npm run compile-sass \
    && {{ edxapp_venv_bin }}/python manage.py lms collectstatic --noinput --settings=$EDX_PLATFORM_SETTINGS \
    && {{ edxapp_venv_bin }}/python manage.py cms collectstatic --noinput --settings=$EDX_PLATFORM_SETTINGS
{% endif %}
